@using MediaPortal.Models
@model UserFilesViewModels
@{
    ViewBag.Title = "UserFilesTitle";
    Layout = "~/Views/Shared/LogoLayout.cshtml";
}

@section userRoutes{
    @for (var i = 0; i < Model.FolderIDs.Count; i++)
    {
        <span id="icon-href-delimiter"></span>
        @Html.ActionLink(Model.FolderNames.ElementAt(i), "UserFiles", "Home", new { folderID = Model.FolderIDs.ElementAt(i)}, htmlAttributes: null)
        
    }
}


@if (Model.Files.ToList().Count == 0)
{
    if (Request.Cookies["registered"] == null)
    {
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
                    <div class="col-md-12 registerText">
                        Эта папка пустая.
                        <br />
                        Пожалуйста загрузите ваши файлы.
                    </div>
                    <div class="col-md-4 col-md-offset-4">
                        @Html.Partial("_UploadCreatePartial", new FileSystemModels() { ParentId = Model.FolderIDs.Count != 0 ? Model.FolderIDs.Last() : null })
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
                    <div class="col-md-12 registerText">Вы успешно зарегистрированы</div>
                    <div class="col-md-8 col-md-offset-2 text-center">
                        Теперь вы можете начать использование LOGO!
                        Загружайте свои файлы и делитесь ими
                        с остальными пользователями!
                    </div>
                    <div class="col-md-4 col-md-offset-4">
                        @Html.Partial("_UploadCreatePartial", new FileSystemModels() { ParentId = Model.FolderIDs.Count != 0 ? Model.FolderIDs.Last() : null })
                    </div>
                </div>
            </div>
        </div>
    }
}
else
{
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-12">
                    <div class="col-md-3 col-md-offset-1">Название</div>
                    <div class="col-md-2 col-md-push-3">Теги</div>
                </div>
                <div class="col-md-9" id="context-menu">

                    @foreach (var item in Model.Files)
                {
                    if (item.Type.Equals("Folder"))
                    {
                            @Html.Partial("FileSystemView", item)
                        }
                    }
                    @foreach (var item in Model.Files)
                {
                    if (!item.Type.Equals("Folder"))
                    {
                            @Html.Partial("FileSystemView", item)
                        }
                    }
                </div>
                <div class="col-md-2 col-md-offset-1 ">
                    @Html.Partial("_UploadCreatePartial", new FileSystemModels() { ParentId = Model.FolderIDs.Count != 0 ? Model.FolderIDs.Last() : null })
                </div>
            </div>
        </div>
    </div>

    <!-- initially hidden right-click menu -->
    <div class="col-md-1 hide" id="rmenu">
        <ul class="rmenu-ul">
            <li class="rmenu-li">Переименовать</li>
            <li class="rmenu-li">Добавить тег</li>
            <li class="rmenu-li">Скачать файл</li>
            <li class="rmenu-li" data-toggle="modal" data-target="#ModalDelete">Удалить файл</li>
        </ul>
    </div>

    <!-- Modal -->
    <div class="modal fade " id="ModalDelete" role="dialog">
        <div class="modal-dialog ">
            <!-- Modal content-->
            <div class="modal-content col-md-6 col-md-offset-4  ModalDeleteww">

                <div class="modal-body col-md-12 col-md-offset-1  ModalDeleterr">
                    <div class="col-md-12 ModalDeleterr1">
                        Вы уверенны, что хотите удалить этот файл
                    </div>
                    <div class="col-md-12 ModalDeleterr ModalDeleterr1">
                        <div class="btn btn-primary col-md-5 ModalDeletecastomPadBot">Ой нет!</div>
                        <div class="btn btn-primary col-md-5 col-md-offset-1  ModalDeletebtn-primary2 ModalDeletecastomPadBot">Да, удалить!</div>
                    </div>
                </div>

            </div>
        </div>
    </div>
}

@section scripts {
    <script>
        $(".fileSystem-list-item").dblclick(function () {

            var folderId = $(this).attr("name");
            var folderName = $(this).attr("folder-name");
            var link = "/Home/UserFiles/" + folderId + "/" + folderName;

            window.location.href = link;
        });

        $(".fileSystem-list-item").click(function () {
            $(this).toggleClass("fileSystem-list-item-active");
        });
    </script>

<script>

        if (document.getElementById('context-menu').addEventListener) {
            document.getElementById('context-menu').addEventListener('contextmenu', function (e) {
                $("#rmenu").toggleClass("hide");
                $("#rmenu").css({
                    position: "absolute",
                    top: e.pageY,
                    left: e.pageX
                }
                );
                e.preventDefault();
            }, false);
        }

</script>

<script>
        $(document).bind("click", function (event) {
            document.getElementById("rmenu").className = "col-md-1 hide";
        });
</script>
}